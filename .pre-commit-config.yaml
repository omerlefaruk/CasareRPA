# Pre-commit hooks for CasareRPA
# Run manually: pre-commit run --all-files
# Install: pre-commit install

repos:
  # General file checks
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v5.0.0
    hooks:
      - id: trailing-whitespace
        name: Trim trailing whitespace
      - id: end-of-file-fixer
        name: Fix end of files
      - id: check-yaml
        name: Check YAML syntax
        args: ['--allow-multiple-documents']
      - id: check-json
        name: Check JSON syntax
      - id: check-added-large-files
        name: Check for large files
        args: ['--maxkb=1000']
      - id: check-merge-conflict
        name: Check for merge conflicts
      - id: debug-statements
        name: Check for debug statements

  # Ruff - Fast Python linter and formatter
  # Enabled with selective ignores for legacy code (Week 2 improvement)
  # GitHub issue created for incremental fixes of ignored rules
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.8.4
    hooks:
      - id: ruff
        name: Ruff linter (with selective ignores)
        args:
          - --fix
          - --exit-non-zero-on-fix
          - --ignore=E402,F401,F821,F841
        # E402: module import not at top of file (~90 errors)
        # F401: unused imports (~10 errors)
        # F821: undefined name (6 errors)
        # F841: unused variable (2 errors)
      - id: ruff-format
        name: Ruff formatter

  # MyPy - Static type checker (DISABLED - too many errors in current codebase)
  # TODO: Enable incrementally after fixing type annotations in clean architecture layers
  # Note: Found 2945 errors across 118 files - needs systematic cleanup
  # - repo: https://github.com/pre-commit/mirrors-mypy
  #   rev: v1.14.1
  #   hooks:
  #     - id: mypy
  #       name: MyPy type checker (clean architecture only)
  #       files: ^src/casare_rpa/(domain|infrastructure|application|presentation)/.*\.py$
  #       args:
  #         - --ignore-missing-imports
  #         - --python-version=3.12
  #         - --no-strict-optional
  #         - --warn-redundant-casts
  #         - --warn-unused-ignores
  #       additional_dependencies:
  #         - types-requests
  #         - types-PyYAML
  #         - pydantic
  #         - PySide6-stubs

  # Quick test suite (optional - run manually with pytest)
  # - repo: local
  #   hooks:
  #     - id: pytest-quick
  #       name: Quick pytest validation
  #       entry: pytest
  #       args: [tests/, -v, --maxfail=3, -x]
  #       language: system
  #       pass_filenames: false
  #       stages: [pre-commit]

  # Agent guide sync check
  - repo: local
    hooks:
      - id: agent-guide-sync
        name: Ensure AGENTS.md/CLAUDE.md/GEMINI.md are synced
        entry: python scripts/sync_agent_guides.py --check
        language: system
        pass_filenames: false
        stages: [pre-commit]
      - id: claude-dir-sync
        name: Ensure .claude mirrors .agent
        entry: python scripts/sync_claude_dir.py --check
        language: system
        pass_filenames: false
        stages: [pre-commit]
      - id: agent-rules-sync
        name: Ensure agent-rules mirrors .agent
        entry: python scripts/sync_agent_rules.py --check
        language: system
        pass_filenames: false
        stages: [pre-commit]
      - id: agent-path-hygiene
        name: Enforce .agent/.claude path hygiene
        entry: python scripts/check_agent_path_hygiene.py
        language: system
        pass_filenames: false
        stages: [pre-commit]
      - id: agent-rules-update
        name: Require AGENTS.md update when agent rules/docs change
        entry: python scripts/check_agent_rule_updates.py
        language: system
        pass_filenames: false
        stages: [pre-commit]
      - id: index-update-check
        name: Require _index.md updates for new .brain/.agent docs
        entry: python scripts/check_index_updates.py
        language: system
        pass_filenames: false
        stages: [pre-commit]
      - id: enforce-doc-updates
        name: Require docs/rules updates when src/ changes
        entry: python scripts/enforce_doc_updates.py
        language: system
        pass_filenames: false
        stages: [pre-commit]
      - id: not-on-main
        name: Block commits on main/master (use worktree)
        entry: python scripts/check_not_main_branch.py
        language: system
        pass_filenames: false
        stages: [pre-commit]
      - id: node-registry-sync
        name: Verify nodes are registered (backend + visual)
        entry: python scripts/check_node_registry_sync.py
        language: system
        pass_filenames: false
        stages: [pre-commit]
      - id: domain-purity
        name: Enforce domain layer purity (no external deps)
        entry: python scripts/check_domain_purity.py
        language: system
        pass_filenames: false
        stages: [pre-commit]
      - id: event-serialization
        name: Verify domain events use serializable types
        entry: python scripts/check_event_serialization.py
        language: system
        pass_filenames: false
        stages: [pre-commit]
      - id: theme-colors
        name: Block hardcoded colors in presentation/
        entry: python scripts/check_theme_colors.py
        language: system
        pass_filenames: false
        stages: [pre-commit]
      - id: blocking-io
        name: Detect blocking I/O in async functions
        entry: python scripts/check_blocking_io.py
        language: system
        pass_filenames: false
        stages: [pre-commit]
      - id: signal-slot-rules
        name: Enforce Signal/Slot best practices (@Slot, no lambdas)
        entry: python scripts/check_signal_slot_usage.py
        language: system
        pass_filenames: false
        stages: [pre-commit]
      - id: http-client-usage
        name: Enforce UnifiedHttpClient (no raw aiohttp/httpx)
        entry: python scripts/check_http_client_usage.py
        language: system
        pass_filenames: false
        stages: [pre-commit]
      - id: node-port-definitions
        name: Verify Modern Node Standard port definitions
        entry: python scripts/check_node_port_definitions.py
        language: system
        pass_filenames: false
        stages: [pre-commit]
      - id: check-secrets
        name: Block hardcoded secrets (API keys, tokens)
        entry: python scripts/check_secrets.py
        language: system
        pass_filenames: false
        stages: [pre-commit]
      - id: logger-usage
        name: Enforce logger in infrastructure/nodes (no print)
        entry: python scripts/check_logger_usage.py
        language: system
        pass_filenames: false
        stages: [pre-commit]
