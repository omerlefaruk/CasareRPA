# Phase 1 Epic 1.1: Token Spec v2 (Dark-Only, Compact)

**Status**: PLAN
**Created**: 2025-12-27
**Epic**: Define an explicit v2 token contract for dark-only, compact UI

---

## Overview

Create a parallel token system (v2) that implements the Cursor/VS Code-like design specification:
- Dark-only theme (no light mode variants)
- Compact density (tight spacing, smaller fonts)
- Cursor-blue accent ramp
- Zero-motion animations (explicitly 0ms)
- Single source of truth for both QSS and custom-painted widgets

**Key Constraint**: Keep v2 tokens unused by legacy UI. No breaking changes.

---

## Files to Create

| Path | Purpose | Est. Lines |
|------|---------|------------|
| `src/casare_rpa/presentation/canvas/theme_system/tokens_v2.py` | V2 token definitions | ~350 |
| `src/casare_rpa/presentation/canvas/theme_system/styles_v2.py` | V2 QSS generators | ~450 |
| `tests/presentation/canvas/theme/test_tokens_v2.py` | V2 token tests | ~250 |

---

## Files to Modify

| Path | Changes | Impact |
|------|---------|--------|
| `src/casare_rpa/presentation/canvas/theme_system/__init__.py` | Add V2 exports | ~20 lines |
| `src/casare_rpa/presentation/canvas/new_main_window.py` | Use V2 tokens when in v2 mode | ~15 lines |

---

## V2 Token Structure Design

### 1. Color Palette (Dark-Only)

```python
@dataclass(frozen=True)
class NeutralRampV2:
    """Cursor-like neutral scale for dark mode."""
    n950: str = "#080808"  # Deepest background (canvas)
    n900: str = "#0f0f0f"  # Surface background (panels)
    n800: str = "#1a1a1a"  # Elevated (dropdowns, popups)
    n700: str = "#252525"  # Component background (inputs)
    n600: str = "#303030"  # Border default
    n500: str = "#404040"  # Border light, hover
    n400: str = "#606060"  # Text disabled
    n300: str = "#808080"  # Text secondary
    n200: str = "#a0a0a0"  # Text primary
    n100: str = "#c0c0c0"  # Text header
```

### 2. Accent Ramp (Cursor-Like Blue)

```python
@dataclass(frozen=True)
class AccentRampV2:
    """Cursor-like blue accent ramp."""
    base: str = "#0066ff"     # Primary accent
    hover: str = "#3385ff"    # Hover state
    active: str = "#0052cc"   # Pressed/active
    subtle: str = "#0066ff20" # 12.5% alpha for backgrounds
```

### 3. Semantic Status Colors

```python
@dataclass(frozen=True)
class SemanticColorsV2:
    """Status colors (unchanged from v1, re-exported for completeness)."""
    success: str = "#10b981"  # Emerald
    warning: str = "#f59e0b"  # Amber
    error: str = "#ef4444"    # Red
    info: str = "#0ea5e9"     # Sky
```

### 4. Compact Typography

```python
@dataclass(frozen=True)
class TypographyV2:
    """Compact font sizes for dense UI."""
    # Font families (will use Geist in Epic 1.2, fallback for now)
    sans: str = "'Inter', 'Segoe UI', sans-serif"
    mono: str = "'JetBrains Mono', 'Cascadia Code', monospace"

    # Compact type scale (1 step smaller than v1)
    display_lg: int = 18   # Page titles
    display_md: int = 16   # Large headings
    heading_lg: int = 14   # Primary headings
    heading_md: int = 13   # Secondary headings
    heading_sm: int = 12   # Tertiary headings
    body_lg: int = 12      # Emphasized body
    body: int = 11         # Default body (was 12 in v1)
    body_sm: int = 10      # Secondary text (was 11 in v1)
    caption: int = 9       # Tiny labels (was 10 in v1)

    # Line heights (tighter for compact)
    lh_tight: float = 1.2   # Headings
    lh_normal: float = 1.4  # Body
    lh_relaxed: float = 1.6  # Long-form

    # Weights
    weight_normal: int = 400
    weight_medium: int = 500
    weight_semibold: int = 600
```

### 5. Tight Spacing (4px Grid)

```python
@dataclass(frozen=True)
class SpacingV2:
    """4px-based spacing, tighter presets."""
    zero: int = 0
    xxs: int = 2   # 0.125rem - Ultra tight
    xs: int = 4    # 0.25rem - Tight (icons in buttons)
    sm: int = 6    # 0.375rem - Compact (form rows) - non-standard but practical
    md: int = 8    # 0.5rem - Default gap
    lg: int = 12   # 0.75rem - Section spacing
    xl: int = 16   # 1rem - Large sections
    xxl: int = 24  # 1.5rem - Major sections
```

### 6. Small Consistent Radii

```python
@dataclass(frozen=True)
class RadiusV2:
    """Small border radius for compact look."""
    none: int = 0
    xs: int = 2    # Tags, chips
    sm: int = 3    # Inputs, buttons (smaller than v1's 4)
    md: int = 4    # Cards, panels (smaller than v1's 8)
    lg: int = 6    # Dialogs (smaller than v1's 12)
```

### 7. Border Rules

```python
@dataclass(frozen=True)
class BorderV2:
    """Border specification - always 1px."""
    width: int = 1  # Always 1px
    focus_width: int = 1  # Focus ring also 1px
    style: str = "solid"
    focus_style: str = "solid"
```

### 8. Zero Motion

```python
@dataclass(frozen=True)
class MotionV2:
    """Zero-motion tokens - all durations are 0ms."""
    instant: int = 0
    fast: int = 0
    normal: int = 0
    slow: int = 0
    # Easing not applicable (no animation)
```

### 9. Unified V2 Tokens Class

```python
@dataclass(frozen=True)
class DesignTokensV2:
    """V2 design tokens - single entry point for new UI."""
    neutral: NeutralRampV2 = NeutralRampV2()
    accent: AccentRampV2 = AccentRampV2()
    semantic: SemanticColorsV2 = SemanticColorsV2()
    typography: TypographyV2 = TypographyV2()
    spacing: SpacingV2 = SpacingV2()
    radius: RadiusV2 = RadiusV2()
    border: BorderV2 = BorderV2()
    motion: MotionV2 = MotionV2()

# Global singleton
TOKENS_V2 = DesignTokensV2()
```

---

## Implementation Steps

### Step 1: Create `tokens_v2.py`

**Agent**: builder

1. Create `src/casare_rpa/presentation/canvas/theme_system/tokens_v2.py`
2. Define all token dataclasses
3. Create `TOKENS_V2` singleton
4. Add docstrings explaining V2 vs V1 differences
5. No changes to existing `colors.py` or `design_tokens.py`

**Estimated time**: 30 minutes

---

### Step 2: Create `styles_v2.py`

**Agent**: builder

1. Create `src/casare_rpa/presentation/canvas/theme_system/styles_v2.py`
2. Port style generators from `styles.py` but:
   - Use `TOKENS_V2.*` instead of `THEME.*` and `TOKENS.*`
   - Remove all transition properties (set to 0ms or omit)
   - Use compact typography sizes
   - Use tight spacing
3. Function signature: `def get_canvas_stylesheet_v2() -> str`

**Estimated time**: 45 minutes

---

### Step 3: Update `__init__.py` Exports

**Agent**: builder

1. Add V2 exports to `theme_system/__init__.py`:
   ```python
   from .tokens_v2 import TOKENS_V2, DesignTokensV2
   from .styles_v2 import get_canvas_stylesheet_v2
   ```
2. Add to `__all__` list

**Estimated time**: 5 minutes

---

### Step 4: Update `new_main_window.py` to Use V2

**Agent**: builder

1. Import `TOKENS_V2` and `get_canvas_stylesheet_v2`
2. Apply V2 stylesheet in `__init__`:
   ```python
   self.setStyleSheet(get_canvas_stylesheet_v2())
   ```
3. Update temporary label to use V2 tokens

**Estimated time**: 10 minutes

---

### Step 5: Create Tests

**Agent**: quality

1. Create `tests/presentation/canvas/theme/test_tokens_v2.py`
2. Test cases:
   - `test_tokens_v2_singleton_exists`
   - `test_neutral_ramp_dark_only`
   - `test_accent_ramp_cursor_blue`
   - `test_compact_typography_smaller_than_v1`
   - `test_tight_spacing_4px_grid`
   - `test_small_consistent_radii`
   - `test_zero_motion_all_zero`
   - `test_border_width_always_1`
   - `test_stylesheet_v2_generates`
   - `test_stylesheet_v2_no_transitions`

**Estimated time**: 30 minutes

---

## Parallel Opportunities

| Tasks | Can Run In Parallel |
|-------|---------------------|
| Step 1 (tokens_v2.py) + Step 5 (test structure) | Yes |
| Step 2 (styles_v2.py) | After Step 1 |
| Step 3 (init exports) + Step 4 (new_main_window) | After Step 2 |

---

## Test Approach

### Unit Tests

```python
# Example test structure
def test_compact_typography_smaller_than_v1():
    """V2 typography should be smaller than V1 for compact density."""
    from ..theme_system import TOKENS, TOKENS_V2

    assert TOKENS_V2.typography.body < TOKENS.typography.body
    assert TOKENS_V2.typography.body_sm < TOKENS.typography.body_s

def test_zero_motion_all_zero():
    """V2 motion tokens should all be 0ms (no animations)."""
    from ..theme_system import TOKENS_V2

    assert TOKENS_V2.motion.instant == 0
    assert TOKENS_V2.motion.fast == 0
    assert TOKENS_V2.motion.normal == 0
    assert TOKENS_V2.motion.slow == 0

def test_stylesheet_v2_no_transitions():
    """V2 stylesheet should not contain any transition properties."""
    from ..theme_system import get_canvas_stylesheet_v2

    qss = get_canvas_stylesheet_v2()
    assert "transition" not in qss.lower()
    assert "animation" not in qss.lower()
```

### Manual Test Steps

```bash
# 1. Launch V2 shell
set CASARE_UI_V2=1 && python run.py

# 2. Verify V2 styling is applied
# - Window background should be darker (#080808)
# - Text should be smaller (11px body)
# - No animations on hover/click
# - Accent color is Cursor blue (#0066ff)
```

### Verification Checklist

- [ ] `TOKENS_V2` singleton imports successfully
- [ ] All token dataclasses are frozen
- [ ] Neutral ramp uses dark-only colors
- [ ] Accent ramp uses Cursor-like blue
- [ ] Typography sizes are smaller than V1
- [ ] Spacing follows 4px grid (with 6px exception)
- [ ] All radius values <= 6px
- [ ] All motion values = 0ms
- [ ] Border width = 1px
- [ ] `get_canvas_stylesheet_v2()` generates valid QSS
- [ ] QSS contains no transition/animation properties
- [ ] NewMainWindow uses V2 stylesheet when `CASARE_UI_V2=1`
- [ ] Legacy UI unaffected (no imports of V2)

---

## Migration Path from V1 to V2

### Phase 1-8 (Development)
- V1 tokens (`THEME`, `TOKENS`) remain default
- V2 tokens (`TOKENS_V2`) available but only used in `new_main_window.py`
- Legacy UI continues using V1

### Phase 9 (Cutover)
1. Switch `new_main_window.py` to become `main_window.py`
2. Rename V2 tokens to become primary (drop `_V2` suffix)
3. Keep V1 as `tokens_legacy.py` for one release
4. Remove V1 in subsequent release

### Rollback Plan

If V2 causes issues:
1. Remove V2 usage from `new_main_window.py`
2. Delete V2 files
3. No impact on legacy UI (V1 untouched)

---

## Risks and Mitigation

| Risk | Impact | Mitigation |
|------|--------|------------|
| V2 tokens accidentally used by legacy code | MEDIUM | Clear `_V2` suffix; lint rule to forbid imports |
| Spacing 6px breaks 4px grid assumption | LOW | Document exception; only for form-row vertical |
| Typography too small for accessibility | MEDIUM | Will address in Epic 1.2 (font scaling) |
| Motion tokens set to 0 cause layout issues | LOW | Test thoroughly; Qt works fine without transitions |
| Color values don't match Cursor exactly | LOW | Close enough; can tweak in later epic |

---

## Dependencies

- **Requires**: Phase 0 Epic 0.1 complete (NewMainWindow stub exists)
- **Blocks**:
  - Epic 1.2: Font bundling (uses TypographyV2)
  - Epic 1.3: Global QSS v2 (uses styles_v2.py)
  - Epic 4.1: NewMainWindow full implementation

---

## Next Steps (After Epic 1.1)

1. Epic 1.2: Font bundling + loader (Geist Sans/Mono)
2. Epic 1.3: Global QSS v2 generation
3. Epic 2.1: Icon system v2 (uses AccentRampV2)

---

## Estimated Effort

| Task | Time |
|------|------|
| Step 1: Create tokens_v2.py | 30 min |
| Step 2: Create styles_v2.py | 45 min |
| Step 3: Update __init__.py | 5 min |
| Step 4: Update new_main_window.py | 10 min |
| Step 5: Create tests | 30 min |
| Manual testing | 15 min |
| **Total** | **2h 15min** |

---

## References

- `docs/UX_REDESIGN_PLAN.md` - Full redesign specification
- `.brain/plans/phase-0-epic-0-1-20251227.md` - Phase 0 foundation
- `src/casare_rpa/presentation/canvas/theme_system/colors.py` - V1 colors (reference)
- `src/casare_rpa/presentation/canvas/theme_system/design_tokens.py` - V1 tokens (reference)
- `src/casare_rpa/presentation/canvas/theme_system/styles.py` - V1 styles (reference)
