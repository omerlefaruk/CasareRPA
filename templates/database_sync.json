{
  "$schema": "casare_rpa/workflow_template/1.0",
  "id": "tmpl_db_sync_001",
  "metadata": {
    "name": "Database Sync",
    "description": "Synchronizes data between databases or between a database and external data sources. Supports insert, update, upsert operations with conflict resolution.",
    "category": "database_operations",
    "version": "1.0.0",
    "author": "CasareRPA",
    "tags": ["database", "sync", "etl", "migration", "sql", "data"],
    "created_at": "2024-11-28T00:00:00",
    "modified_at": "2024-11-28T00:00:00",
    "icon": "database",
    "preview_image": "",
    "difficulty": "advanced",
    "estimated_duration": "5-30 minutes",
    "requirements": ["Database drivers", "Source/target database access"]
  },
  "parameters": [
    {
      "name": "source_connection",
      "display_name": "Source Connection String",
      "description": "Connection string for source database",
      "param_type": "credential",
      "default_value": null,
      "required": true,
      "constraints": {},
      "group": "Source",
      "order": 0
    },
    {
      "name": "source_query",
      "display_name": "Source Query",
      "description": "SQL query to fetch data from source",
      "param_type": "string",
      "default_value": "SELECT * FROM source_table",
      "required": true,
      "constraints": {},
      "group": "Source",
      "order": 1
    },
    {
      "name": "target_connection",
      "display_name": "Target Connection String",
      "description": "Connection string for target database",
      "param_type": "credential",
      "default_value": null,
      "required": true,
      "constraints": {},
      "group": "Target",
      "order": 2
    },
    {
      "name": "target_table",
      "display_name": "Target Table",
      "description": "Table name in target database",
      "param_type": "string",
      "default_value": "",
      "required": true,
      "constraints": {},
      "group": "Target",
      "order": 3
    },
    {
      "name": "sync_mode",
      "display_name": "Sync Mode",
      "description": "How to handle data synchronization",
      "param_type": "choice",
      "default_value": "upsert",
      "required": false,
      "constraints": {"choices": ["insert", "update", "upsert", "replace"]},
      "group": "Sync Options",
      "order": 4
    },
    {
      "name": "primary_key",
      "display_name": "Primary Key Column(s)",
      "description": "Column(s) to identify records for update/upsert (comma-separated)",
      "param_type": "string",
      "default_value": "id",
      "required": false,
      "constraints": {},
      "group": "Sync Options",
      "order": 5
    },
    {
      "name": "column_mapping",
      "display_name": "Column Mapping",
      "description": "JSON mapping of source to target columns (empty = same names)",
      "param_type": "json",
      "default_value": {},
      "required": false,
      "constraints": {},
      "group": "Mapping",
      "order": 6
    },
    {
      "name": "transform_rules",
      "display_name": "Transform Rules",
      "description": "JSON rules for data transformation per column",
      "param_type": "json",
      "default_value": {},
      "required": false,
      "constraints": {},
      "group": "Mapping",
      "order": 7
    },
    {
      "name": "batch_size",
      "display_name": "Batch Size",
      "description": "Number of records per batch",
      "param_type": "integer",
      "default_value": 1000,
      "required": false,
      "constraints": {"min": 1, "max": 10000},
      "group": "Performance",
      "order": 8
    },
    {
      "name": "dry_run",
      "display_name": "Dry Run",
      "description": "Simulate sync without making changes",
      "param_type": "boolean",
      "default_value": false,
      "required": false,
      "constraints": {},
      "group": "Options",
      "order": 9
    },
    {
      "name": "log_changes",
      "display_name": "Log Changes",
      "description": "Log all insert/update operations",
      "param_type": "boolean",
      "default_value": true,
      "required": false,
      "constraints": {},
      "group": "Options",
      "order": 10
    },
    {
      "name": "on_error",
      "display_name": "On Error",
      "description": "How to handle errors during sync",
      "param_type": "choice",
      "default_value": "skip",
      "required": false,
      "constraints": {"choices": ["stop", "skip", "rollback"]},
      "group": "Error Handling",
      "order": 11
    }
  ],
  "workflow_definition": {
    "metadata": {
      "name": "Database Sync Workflow",
      "description": "Generated from Database Sync template",
      "version": "1.0.0"
    },
    "nodes": {
      "start_001": {
        "node_id": "start_001",
        "node_type": "StartNode",
        "name": "Start",
        "position": [100, 200],
        "config": {}
      },
      "db_connect_src_001": {
        "node_id": "db_connect_src_001",
        "node_type": "DatabaseConnectNode",
        "name": "Connect Source DB",
        "position": [300, 200],
        "config": {
          "connection_string": "{{source_connection}}"
        }
      },
      "db_query_001": {
        "node_id": "db_query_001",
        "node_type": "DatabaseQueryNode",
        "name": "Fetch Source Data",
        "position": [500, 200],
        "config": {
          "query": "{{source_query}}"
        }
      },
      "log_count_001": {
        "node_id": "log_count_001",
        "node_type": "LogNode",
        "name": "Log Record Count",
        "position": [700, 200],
        "config": {
          "message": "Fetched {{record_count}} records from source"
        }
      },
      "branch_dry_001": {
        "node_id": "branch_dry_001",
        "node_type": "BranchNode",
        "name": "Dry Run?",
        "position": [900, 200],
        "config": {
          "condition": "{{dry_run}}"
        }
      },
      "log_dry_001": {
        "node_id": "log_dry_001",
        "node_type": "LogNode",
        "name": "Log Dry Run",
        "position": [1100, 100],
        "config": {
          "message": "DRY RUN: Would sync {{record_count}} records to {{target_table}}"
        }
      },
      "db_connect_tgt_001": {
        "node_id": "db_connect_tgt_001",
        "node_type": "DatabaseConnectNode",
        "name": "Connect Target DB",
        "position": [1100, 300],
        "config": {
          "connection_string": "{{target_connection}}"
        }
      },
      "transform_001": {
        "node_id": "transform_001",
        "node_type": "TransformDataNode",
        "name": "Apply Transforms",
        "position": [1300, 300],
        "config": {
          "column_mapping": "{{column_mapping}}",
          "rules": "{{transform_rules}}"
        }
      },
      "batch_loop_001": {
        "node_id": "batch_loop_001",
        "node_type": "BatchProcessNode",
        "name": "Process Batches",
        "position": [1500, 300],
        "config": {
          "batch_size": "{{batch_size}}"
        }
      },
      "db_upsert_001": {
        "node_id": "db_upsert_001",
        "node_type": "DatabaseUpsertNode",
        "name": "Sync Batch",
        "position": [1700, 300],
        "config": {
          "table": "{{target_table}}",
          "mode": "{{sync_mode}}",
          "primary_key": "{{primary_key}}",
          "on_error": "{{on_error}}"
        }
      },
      "branch_log_001": {
        "node_id": "branch_log_001",
        "node_type": "BranchNode",
        "name": "Log Changes?",
        "position": [1900, 300],
        "config": {
          "condition": "{{log_changes}}"
        }
      },
      "log_batch_001": {
        "node_id": "log_batch_001",
        "node_type": "LogNode",
        "name": "Log Batch",
        "position": [2100, 200],
        "config": {
          "message": "Batch {{batch_number}}: {{inserted}} inserted, {{updated}} updated"
        }
      },
      "db_disconnect_src_001": {
        "node_id": "db_disconnect_src_001",
        "node_type": "DatabaseDisconnectNode",
        "name": "Disconnect Source",
        "position": [2300, 200],
        "config": {}
      },
      "db_disconnect_tgt_001": {
        "node_id": "db_disconnect_tgt_001",
        "node_type": "DatabaseDisconnectNode",
        "name": "Disconnect Target",
        "position": [2500, 200],
        "config": {}
      },
      "log_summary_001": {
        "node_id": "log_summary_001",
        "node_type": "LogNode",
        "name": "Log Summary",
        "position": [2700, 200],
        "config": {
          "message": "Sync completed: {{total_inserted}} inserted, {{total_updated}} updated, {{total_errors}} errors"
        }
      },
      "end_001": {
        "node_id": "end_001",
        "node_type": "EndNode",
        "name": "End",
        "position": [2900, 200],
        "config": {}
      }
    },
    "connections": [
      {"source_node": "start_001", "source_port": "exec_out", "target_node": "db_connect_src_001", "target_port": "exec_in"},
      {"source_node": "db_connect_src_001", "source_port": "exec_out", "target_node": "db_query_001", "target_port": "exec_in"},
      {"source_node": "db_query_001", "source_port": "exec_out", "target_node": "log_count_001", "target_port": "exec_in"},
      {"source_node": "log_count_001", "source_port": "exec_out", "target_node": "branch_dry_001", "target_port": "exec_in"},
      {"source_node": "branch_dry_001", "source_port": "true", "target_node": "log_dry_001", "target_port": "exec_in"},
      {"source_node": "branch_dry_001", "source_port": "false", "target_node": "db_connect_tgt_001", "target_port": "exec_in"},
      {"source_node": "log_dry_001", "source_port": "exec_out", "target_node": "db_disconnect_src_001", "target_port": "exec_in"},
      {"source_node": "db_connect_tgt_001", "source_port": "exec_out", "target_node": "transform_001", "target_port": "exec_in"},
      {"source_node": "transform_001", "source_port": "exec_out", "target_node": "batch_loop_001", "target_port": "exec_in"},
      {"source_node": "batch_loop_001", "source_port": "loop_body", "target_node": "db_upsert_001", "target_port": "exec_in"},
      {"source_node": "db_upsert_001", "source_port": "exec_out", "target_node": "branch_log_001", "target_port": "exec_in"},
      {"source_node": "branch_log_001", "source_port": "true", "target_node": "log_batch_001", "target_port": "exec_in"},
      {"source_node": "branch_log_001", "source_port": "false", "target_node": "batch_loop_001", "target_port": "loop_next"},
      {"source_node": "log_batch_001", "source_port": "exec_out", "target_node": "batch_loop_001", "target_port": "loop_next"},
      {"source_node": "batch_loop_001", "source_port": "exec_out", "target_node": "db_disconnect_src_001", "target_port": "exec_in"},
      {"source_node": "db_disconnect_src_001", "source_port": "exec_out", "target_node": "db_disconnect_tgt_001", "target_port": "exec_in"},
      {"source_node": "db_disconnect_tgt_001", "source_port": "exec_out", "target_node": "log_summary_001", "target_port": "exec_in"},
      {"source_node": "log_summary_001", "source_port": "exec_out", "target_node": "end_001", "target_port": "exec_in"}
    ],
    "frames": [],
    "variables": {
      "record_count": {
        "type": "Integer",
        "default_value": 0,
        "description": "Total records fetched"
      },
      "batch_number": {
        "type": "Integer",
        "default_value": 0,
        "description": "Current batch number"
      },
      "total_inserted": {
        "type": "Integer",
        "default_value": 0,
        "description": "Total records inserted"
      },
      "total_updated": {
        "type": "Integer",
        "default_value": 0,
        "description": "Total records updated"
      },
      "total_errors": {
        "type": "Integer",
        "default_value": 0,
        "description": "Total errors encountered"
      }
    },
    "settings": {
      "stop_on_error": false,
      "timeout": 1800,
      "retry_count": 2
    }
  },
  "usage_stats": {
    "total_uses": 0,
    "last_used": null,
    "successful_instantiations": 0,
    "failed_instantiations": 0,
    "average_rating": null,
    "rating_count": 0
  },
  "is_builtin": true,
  "source": "builtin",
  "marketplace_id": null
}
