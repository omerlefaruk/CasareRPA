# CasareRPA Production Environment Overlay
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: casare-rpa

resources:
  - ../../base

namePrefix: ""
nameSuffix: ""

commonLabels:
  environment: production

# Use production image tags (pinned versions recommended)
images:
  - name: casare-rpa/orchestrator
    newTag: v1.0.0
  - name: casare-rpa/robot
    newTag: v1.0.0

# Patch deployments for production environment
patches:
  - path: patches/orchestrator-patch.yaml
  - path: patches/robot-patch.yaml
  - path: patches/ingress-patch.yaml
  - path: patches/security-patch.yaml

# Override configmaps for production
configMapGenerator:
  - name: casare-orchestrator-config
    behavior: merge
    literals:
      - CASARE_ENV=production
      - CASARE_LOG_LEVEL=INFO
      - CASARE_LOG_FORMAT=json
      - JWT_DEV_MODE=false
      - WORKERS=4

  - name: casare-robot-config
    behavior: merge
    literals:
      - CASARE_ENV=production
      - CASARE_LOG_LEVEL=INFO
      - CASARE_LOG_FORMAT=json
      - MAX_CONCURRENT_WORKFLOWS=3
      - BROWSER_HEADLESS=true

# Production secrets should be managed by external-secrets or sealed-secrets
# This is a placeholder - DO NOT store real secrets here
secretGenerator:
  - name: casare-secrets
    behavior: replace
    # In production, use external-secrets operator to sync from:
    # - AWS Secrets Manager
    # - HashiCorp Vault
    # - Azure Key Vault
    # - GCP Secret Manager
    literals:
      - DATABASE_URL=MANAGED_BY_EXTERNAL_SECRETS
      - JWT_SECRET_KEY=MANAGED_BY_EXTERNAL_SECRETS
      - REDIS_URL=MANAGED_BY_EXTERNAL_SECRETS
