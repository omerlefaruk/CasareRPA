# Development robot patches
# Reduce replicas, resources, scaling for dev environment
apiVersion: apps/v1
kind: Deployment
metadata:
  name: casare-browser-robot
spec:
  replicas: 1
  template:
    spec:
      containers:
        - name: robot
          resources:
            requests:
              cpu: 250m
              memory: 512Mi
            limits:
              cpu: 1000m
              memory: 2Gi
          env:
            - name: DEBUG
              value: "true"

---
# Reduce KEDA scaling in dev
apiVersion: keda.sh/v1alpha1
kind: ScaledObject
metadata:
  name: casare-robot-scaler
spec:
  minReplicaCount: 1
  maxReplicaCount: 5
  triggers:
    - type: postgresql
      metadata:
        connectionFromEnv: DATABASE_URL
        query: "SELECT COUNT(*) FROM job_queue WHERE status = 'pending' AND robot_type = 'browser'"
        targetQueryValue: "2"
        activationTargetQueryValue: "1"

---
# Relax PDB for dev
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: casare-robot-pdb
spec:
  minAvailable: 0
