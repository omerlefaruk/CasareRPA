# Staging robot patches
# Medium resources and scaling for staging
apiVersion: apps/v1
kind: Deployment
metadata:
  name: casare-browser-robot
spec:
  replicas: 2
  template:
    spec:
      containers:
        - name: robot
          resources:
            requests:
              cpu: 400m
              memory: 768Mi
            limits:
              cpu: 1500m
              memory: 3Gi

---
# Staging KEDA scaling
apiVersion: keda.sh/v1alpha1
kind: ScaledObject
metadata:
  name: casare-robot-scaler
spec:
  minReplicaCount: 2
  maxReplicaCount: 20
  triggers:
    - type: postgresql
      metadata:
        connectionFromEnv: DATABASE_URL
        query: "SELECT COUNT(*) FROM job_queue WHERE status = 'pending' AND robot_type = 'browser'"
        targetQueryValue: "4"
        activationTargetQueryValue: "2"
    # Reduced business hours scaling
    - type: cron
      metadata:
        timezone: America/New_York
        start: "0 8 * * 1-5"
        end: "0 18 * * 1-5"
        desiredReplicas: "10"
