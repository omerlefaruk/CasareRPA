# CasareRPA Local Testing Guide

## Current Status

‚úÖ **Robot CLI** - Working
‚ö†Ô∏è **Orchestrator** - Has missing dependencies (needs fixing)
üîÑ **Canvas** - Ready to test

## Quick Start: Test What Works Now

### 1. Test Robot Standalone

The robot can run standalone without an orchestrator for testing:

```bash
# Activate environment
.venv\Scripts\activate

# Show robot help
python -m casare_rpa.robot.cli --help

# Start robot (will run in offline mode without orchestrator)
python -m casare_rpa.robot.cli start --verbose
```

**Expected Output:**
```
[INFO] Robot starting...
[INFO] Robot ID: <auto-generated-uuid>
[INFO] Robot Name: DESKTOP-<your-pc-name>
[INFO] Connection mode: Offline (no Supabase URL configured)
[INFO] Offline queue initialized
[INFO] Robot ready (offline mode)
```

**What this proves:**
- Robot can start and generate ID
- Offline mode works
- Ready to execute jobs when orchestrator is available

**To stop:**
- Press `Ctrl+C`
- Or in another terminal: `python -m casare_rpa.robot.cli stop --robot-id <robot-id>`

---

### 2. Test Canvas (Visual Workflow Designer)

```bash
# Activate environment
.venv\Scripts\activate

# Launch Canvas
python -m casare_rpa.main
```

**What Opens:**
- Main window with node graph canvas
- Node palette (left sidebar)
- Properties panel (right sidebar)
- Bottom panel with Variables, Triggers, Logs tabs

**Create a Simple Test Workflow:**

1. **Add Start Node:**
   - Drag "Start" from Control Flow ‚Üí Basics
   - Place on canvas

2. **Add Log Node:**
   - Drag "Log Message" from Utility ‚Üí Logging
   - Connect: Start ‚Üí Log Message (drag from output port)

3. **Configure Log Node:**
   - Click the Log Message node
   - In properties panel (right):
     - Message: `"Hello from CasareRPA!"`
     - Level: `INFO`

4. **Add Delay Node (Optional):**
   - Drag "Delay" from Control Flow ‚Üí Wait
   - Connect: Log Message ‚Üí Delay
   - Configure: Duration = `2` seconds

5. **Add End Node:**
   - Drag "End" from Control Flow ‚Üí Basics
   - Connect: Delay ‚Üí End (or Log ‚Üí End if skipped delay)

6. **Save Workflow:**
   - Press `Ctrl+S`
   - Choose location: `workflows/test_hello.json`
   - Click Save

**Test Local Execution:**

1. Press `F3` or click "Run" button (play icon)
2. Watch nodes change color:
   - üü° Yellow = Running
   - üü¢ Green = Completed
   - üî¥ Red = Error

3. Check Logs tab (bottom panel):
   ```
   [INFO] Workflow started: test_hello
   [INFO] Executing node: start_1
   [INFO] Executing node: log_1
   [INFO] Hello from CasareRPA!
   [INFO] Executing node: delay_1
   [INFO] Waiting 2.0 seconds...
   [INFO] Executing node: end_1
   [INFO] Workflow completed successfully
   ```

**What this proves:**
- Canvas UI works
- Workflow design works
- Node execution works locally
- Serialization (save/load) works

---

### 3. Inspect Workflow JSON

Open the saved workflow file:

```bash
cat workflows\test_hello.json
```

**Expected Structure:**
```json
{
  "metadata": {
    "name": "test_hello",
    "description": "",
    "version": "1.0.0",
    "created_at": "2025-11-29T...",
    "modified_at": "2025-11-29T..."
  },
  "nodes": {
    "start_1": {
      "node_id": "start_1",
      "node_type": "StartNode",
      "position": [100, 100],
      "config": {}
    },
    "log_1": {
      "node_id": "log_1",
      "node_type": "LogMessageNode",
      "position": [300, 100],
      "config": {
        "message": "Hello from CasareRPA!",
        "level": "INFO"
      }
    },
    ...
  },
  "connections": [
    {
      "source_node": "start_1",
      "source_port": "exec",
      "target_node": "log_1",
      "target_port": "exec"
    },
    ...
  ],
  "variables": {},
  "settings": {
    "stop_on_error": true
  }
}
```

**This JSON format is what the Robot will execute!**

---

## Next Steps (After Orchestrator is Fixed)

### Once Orchestrator Dependencies Are Resolved:

**Terminal 1 - Orchestrator:**
```bash
.venv\Scripts\activate
python run_orchestrator.py
```

**Terminal 2 - Robot:**
```bash
.venv\Scripts\activate
python -m casare_rpa.robot.cli start --verbose
```

**Terminal 3 - Submit Job:**
```python
# submit_job.py
import asyncio
import orjson
from pathlib import Path
from casare_rpa.application.orchestrator.orchestrator_engine import OrchestratorEngine
from casare_rpa.domain.orchestrator.entities import JobPriority

async def submit_workflow():
    workflow_path = Path("workflows/test_hello.json")
    workflow_data = orjson.loads(workflow_path.read_bytes())

    orchestrator = OrchestratorEngine()
    await orchestrator.start()

    job = await orchestrator.submit_job(
        workflow_id="test-001",
        workflow_name=workflow_data["metadata"]["name"],
        workflow_json=orjson.dumps(workflow_data).decode(),
        robot_id=None,
        priority=JobPriority.NORMAL
    )

    print(f"‚úÖ Job submitted: {job.id}")
    print(f"   Status: {job.status}")
    await orchestrator.stop()

if __name__ == "__main__":
    asyncio.run(submit_workflow())
```

```bash
python submit_job.py
```

**Expected Flow:**
1. Job appears in Orchestrator dashboard as "QUEUED"
2. Robot polls and claims job
3. Robot status changes to "BUSY"
4. Job status changes to "RUNNING"
5. Workflow executes on Robot
6. Job status changes to "COMPLETED"
7. Robot status changes to "IDLE"

---

## Troubleshooting

### Robot Won't Start
```bash
# Check Python version
python --version  # Should be 3.12+

# Check dependencies
pip list | grep casare

# Try with verbose logging
python -m casare_rpa.robot.cli start --verbose
```

### Canvas Won't Open
```bash
# Check PySide6 installed
pip install PySide6

# Check NodeGraphQt
pip install NodeGraphQt

# Try running directly
python -m casare_rpa.main
```

### Workflow Execution Fails
1. Check Logs tab in Canvas
2. Look for node-specific errors
3. Verify node configurations
4. Check required resources (e.g., browser for browser nodes)

---

## Testing Checklist

- [ ] Robot CLI shows help
- [ ] Robot starts in offline mode
- [ ] Canvas opens successfully
- [ ] Can create workflow with nodes
- [ ] Can connect nodes
- [ ] Can configure node properties
- [ ] Can save workflow (Ctrl+S)
- [ ] Saved JSON file exists
- [ ] Can run workflow locally (F3)
- [ ] Nodes execute in correct order
- [ ] Logs appear in Logs tab
- [ ] Workflow completes successfully

---

## Current Limitations

1. **Orchestrator** - Module dependencies need fixing:
   - Missing: `delegates` module
   - Missing: Various UI components
   - **Workaround:** Test Canvas and Robot independently first

2. **Robot-Orchestrator Connection** - Requires:
   - Working Orchestrator WebSocket server
   - Or Supabase backend configured

3. **Job Submission** - Manual for now:
   - No direct "Submit to Orchestrator" button in Canvas
   - Use Python script to submit jobs

---

## Files Created During Testing

```
%USERPROFILE%\.casare_rpa\
‚îú‚îÄ‚îÄ robot_id                    # Auto-generated robot UUID
‚îú‚îÄ‚îÄ robot_config.json           # Robot configuration (if created)
‚îú‚îÄ‚îÄ offline_queue.db            # SQLite offline job queue
‚îú‚îÄ‚îÄ audit\                      # Audit logs
‚îÇ   ‚îî‚îÄ‚îÄ robot_*.log
‚îî‚îÄ‚îÄ robot_<id>_status.json      # Robot status file
```

```
workflows\
‚îî‚îÄ‚îÄ test_hello.json             # Your saved workflow
```

---

## Quick Commands Reference

```bash
# Robot
python -m casare_rpa.robot.cli --help
python -m casare_rpa.robot.cli start
python -m casare_rpa.robot.cli status
python -m casare_rpa.robot.cli stop --robot-id <id>

# Canvas
python -m casare_rpa.main

# Orchestrator (when fixed)
python run_orchestrator.py
```

---

## What to Test Next

1. **Browser Automation Workflow:**
   - LaunchBrowser ‚Üí Navigate ‚Üí WaitForSelector ‚Üí GetText ‚Üí CloseBrowser

2. **Desktop Automation Workflow:**
   - FindWindow ‚Üí ClickElement ‚Üí TypeText

3. **Control Flow:**
   - If/Else conditions
   - For loops with variables
   - Try/Catch error handling

4. **Variables:**
   - Define workflow variables
   - Use {{variable}} syntax in node configs
   - Modify variables during execution
